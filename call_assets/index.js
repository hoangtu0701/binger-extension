var y=(f,m,r)=>new Promise((g,p)=>{var i=o=>{try{a(r.next(o))}catch(s){p(s)}},u=o=>{try{a(r.throw(o))}catch(s){p(s)}},a=o=>o.done?g(o.value):Promise.resolve(o.value).then(i,u);a((r=r.apply(f,m)).next())});(function(){"use strict";var f=document.createElement("style");f.textContent=`body{margin-top:4.6vh;font-family:system-ui,sans-serif;background:#111;color:#fff;display:flex;flex-direction:column;align-items:center;gap:6vh}.videos{display:flex;flex-direction:row;justify-content:center;gap:2vw;width:93vw;height:73vh}video{background:#000;width:50%;height:100%;max-width:480px;aspect-ratio:16/9;object-fit:cover;border:2px solid #444;border-radius:15px}.controls{display:flex;gap:8px}.controls button{background:#222;color:#ddd;transition:background .3s;padding:8px 12px;border-radius:8px;border:none;font-size:14px;cursor:pointer}.controls button:disabled{opacity:.5;cursor:not-allowed}.controls button:hover:not(:disabled){background:#333}
/*$vite$:1*/`,document.head.appendChild(f);const m={apiKey:"AIzaSyDhppVbz4-sx1oYls62iXOPOR8Yrq-N9Qk",authDomain:"binger-video-call.firebaseapp.com",databaseURL:"https://binger-video-call-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"binger-video-call",storageBucket:"binger-video-call.firebasestorage.app",messagingSenderId:"1025922887951",appId:"1:1025922887951:web:70f733811d4ed19a8d8e7a"};firebase.initializeApp(m,"caller"),firebase.database.INTERNAL.forceWebSockets();const r=firebase.app("caller").database();document.addEventListener("DOMContentLoaded",()=>y(null,null,function*(){yield firebase.app("caller").auth().signInAnonymously().catch(e=>{console.error("Firebase anonymous auth failed:",e)});const i=new URLSearchParams(window.location.search).get("roomId");if(!i)return console.error("❌ roomId missing");console.log(`🚀 Joining calls/${i}`);const u=r.ref(`calls/${i}`),a=r.ref(`calls/${i}/users`),o=r.ref(`calls/${i}/signals`),s=a.push({joined:Date.now()}),d=s.key;console.log(`👤 User ${d} joined`),s.onDisconnect().remove(),u.onDisconnect().remove();const k=document.getElementById("localVideo"),O=document.getElementById("remoteVideo"),b=document.getElementById("btnToggleMic"),h=document.getElementById("btnToggleCam");let n=null;try{n=yield navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),n.getTracks().forEach(e=>e.enabled=!1),k.srcObject=n,b.disabled=!1,h.disabled=!1}catch(e){console.warn("🎥 getUserMedia failed – receive-only mode")}const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});n?n.getTracks().forEach(e=>t.addTrack(e,n)):(t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"}));const w=new MediaStream;O.srcObject=w,t.ontrack=e=>w.addTrack(e.track),t.onicecandidate=e=>{e.candidate&&o.push({type:"candidate",from:d,payload:e.candidate.toJSON()})};const I=yield new Promise(e=>{a.once("value",c=>{const l=Object.keys(c.val()||{});l.sort(),e(l[0]===d)})});let v=!1;if(o.on("child_added",e=>y(null,null,function*(){const c=e.val();if(c.from!==d)try{switch(c.type){case"offer":if(v||t.currentRemoteDescription)return;v=!0,yield t.setRemoteDescription(c.payload);const l=yield t.createAnswer();yield t.setLocalDescription(l),o.push({type:"answer",from:d,payload:l}),console.log("📨 Answer sent");break;case"answer":t.currentRemoteDescription||(yield t.setRemoteDescription(c.payload));break;case"candidate":yield t.addIceCandidate(new RTCIceCandidate(c.payload));break}}catch(l){console.warn("⚠️ Signal handling error:",l)}})),I){const e=yield t.createOffer();yield t.setLocalDescription(e),o.push({type:"offer",from:d,payload:e}),console.log("📨 Offer sent (I’m offerer)")}else console.log("🕗 Waiting for offer… (I’m answerer)");t.oniceconnectionstatechange=()=>{t.iceConnectionState==="connected"&&o.remove().catch(()=>{})},n&&(b.onclick=()=>{const e=n.getAudioTracks()[0];e.enabled=!e.enabled,b.textContent=e.enabled?"🎤 Mic":"🚫 Mic"},h.onclick=()=>{const e=n.getVideoTracks()[0];e.enabled=!e.enabled,h.textContent=e.enabled?"📹 Cam":"🚫 Cam",k.style.opacity=e.enabled?"1":"0.3"}),window.addEventListener("beforeunload",()=>{t.close(),n&&n.getTracks().forEach(e=>e.stop())})}))})();
