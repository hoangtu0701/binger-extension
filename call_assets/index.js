var g=(m,b,c)=>new Promise((h,d)=>{var i=o=>{try{r(c.next(o))}catch(s){d(s)}},n=o=>{try{r(c.throw(o))}catch(s){d(s)}},r=o=>o.done?h(o.value):Promise.resolve(o.value).then(i,n);r((c=c.apply(m,b)).next())});(function(){"use strict";var m=document.createElement("style");m.textContent=`body{margin-top:4.6vh;font-family:system-ui,sans-serif;background:#111;color:#fff;display:flex;flex-direction:column;align-items:center;gap:6vh}.videos{display:flex;flex-direction:row;justify-content:center;gap:2vw;width:93vw;height:73vh}video{background:#000;width:50%;height:100%;max-width:480px;aspect-ratio:16/9;object-fit:cover;border:2px solid #444;border-radius:15px}.controls{display:flex;gap:8px}.controls button{background:#222;color:#ddd;transition:background .3s;padding:8px 12px;border-radius:8px;border:none;font-size:14px;cursor:pointer}.controls button:disabled{opacity:.5;cursor:not-allowed}.controls button:hover:not(:disabled){background:#333}
/*$vite$:1*/`,document.head.appendChild(m);const b={apiKey:"AIzaSyDhppVbz4-sx1oYls62iXOPOR8Yrq-N9Qk",authDomain:"binger-video-call.firebaseapp.com",databaseURL:"https://binger-video-call-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"binger-video-call",storageBucket:"binger-video-call.firebasestorage.app",messagingSenderId:"1025922887951",appId:"1:1025922887951:web:70f733811d4ed19a8d8e7a"};firebase.initializeApp(b,"caller"),firebase.database.INTERNAL.forceWebSockets();const c=firebase.app("caller").database();function h(){return g(this,null,function*(){return new Promise(d=>{const i=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});let n=!1;i.onicecandidate=r=>{if(!r.candidate){i.close(),d(!n);return}r.candidate.candidate.includes("srflx")&&(n=!0)},i.createDataChannel("probe"),i.createOffer().then(r=>i.setLocalDescription(r)).catch(()=>d(!0))})})}document.addEventListener("DOMContentLoaded",()=>g(null,null,function*(){yield firebase.app("caller").auth().signInAnonymously().catch(e=>{console.error("Firebase anonymous auth failed:",e)});const n=new URLSearchParams(window.location.search).get("roomId");if(!n)return console.error("âŒ roomId missing");console.log(`ðŸš€ Joining calls/${n}`),(yield h())&&window.parent!==window&&window.parent.postMessage({type:"network-warning"},"*");const o=c.ref(`calls/${n}`),s=c.ref(`calls/${n}/users`),p=c.ref(`calls/${n}/signals`),k=s.push({joined:Date.now()}),u=k.key;console.log(`ðŸ‘¤ User ${u} joined`),k.onDisconnect().remove(),o.onDisconnect().remove();const v=document.getElementById("localVideo"),C=document.getElementById("remoteVideo"),y=document.getElementById("btnToggleMic"),w=document.getElementById("btnToggleCam");let a=null;try{a=yield navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),a.getTracks().forEach(e=>e.enabled=!1),v.srcObject=a,y.disabled=!1,w.disabled=!1}catch(e){console.warn("ðŸŽ¥ getUserMedia failed â€“ receive-only mode")}const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});a?a.getTracks().forEach(e=>t.addTrack(e,a)):(t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"}));const O=new MediaStream;C.srcObject=O,t.ontrack=e=>O.addTrack(e.track),t.onicecandidate=e=>{e.candidate&&p.push({type:"candidate",from:u,payload:e.candidate.toJSON()})};const I=yield new Promise(e=>{s.once("value",l=>{const f=Object.keys(l.val()||{});f.sort(),e(f[0]===u)})});let x=!1;if(p.on("child_added",e=>g(null,null,function*(){const l=e.val();if(l.from!==u)try{switch(l.type){case"offer":if(x||t.currentRemoteDescription)return;x=!0,yield t.setRemoteDescription(l.payload);const f=yield t.createAnswer();yield t.setLocalDescription(f),p.push({type:"answer",from:u,payload:f}),console.log("ðŸ“¨ Answer sent");break;case"answer":t.currentRemoteDescription||(yield t.setRemoteDescription(l.payload));break;case"candidate":yield t.addIceCandidate(new RTCIceCandidate(l.payload));break}}catch(f){console.warn("âš ï¸ Signal handling error:",f)}})),I){const e=yield t.createOffer();yield t.setLocalDescription(e),p.push({type:"offer",from:u,payload:e}),console.log("ðŸ“¨ Offer sent (Iâ€™m offerer)")}else console.log("ðŸ•— Waiting for offerâ€¦ (Iâ€™m answerer)");t.oniceconnectionstatechange=()=>{t.iceConnectionState==="connected"&&p.remove().catch(()=>{})},a&&(y.onclick=()=>{const e=a.getAudioTracks()[0];e.enabled=!e.enabled,y.textContent=e.enabled?"ðŸŽ¤ Mic":"ðŸš« Mic"},w.onclick=()=>{const e=a.getVideoTracks()[0];e.enabled=!e.enabled,w.textContent=e.enabled?"ðŸ“¹ Cam":"ðŸš« Cam",v.style.opacity=e.enabled?"1":"0.3"}),window.addEventListener("beforeunload",()=>{t.close(),a&&a.getTracks().forEach(e=>e.stop())})}))})();
