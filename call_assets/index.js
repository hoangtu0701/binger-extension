var h=(f,m,r)=>new Promise((b,u)=>{var i=o=>{try{a(r.next(o))}catch(s){u(s)}},p=o=>{try{a(r.throw(o))}catch(s){u(s)}},a=o=>o.done?b(o.value):Promise.resolve(o.value).then(i,p);a((r=r.apply(f,m)).next())});(function(){"use strict";var f=document.createElement("style");f.textContent=`body{margin:0;font-family:system-ui,sans-serif;background:#111;color:#fff;display:flex;flex-direction:column;align-items:center;gap:12px}video{background:#000;width:45vw;max-width:480px;aspect-ratio:16/9;border:2px solid #444;border-radius:8px}.controls{display:flex;gap:8px}button,input{padding:8px 12px;border-radius:6px;border:none;font-size:14px}button{cursor:pointer}input{width:160px}.controls button{background:#222;color:#ddd;border:1px solid #444;transition:background .2s}.controls button:hover:not(:disabled){background:#333}.controls button:disabled{opacity:.5;cursor:not-allowed}
/*$vite$:1*/`,document.head.appendChild(f);const m={apiKey:"AIzaSyCOBk1uGy_Mb29zeww7KlwaTcvvfKrzKoo",authDomain:"binger-extension.firebaseapp.com",databaseURL:"https://binger-extension-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"binger-extension",storageBucket:"binger-extension.appspot.com",messagingSenderId:"6476560552",appId:"1:6476560552:web:fc5d9801506dbef89daa0"};firebase.initializeApp(m),firebase.database.INTERNAL.forceWebSockets();const r=firebase.database();document.addEventListener("DOMContentLoaded",()=>h(null,null,function*(){yield firebase.auth().signInAnonymously().catch(e=>{console.error("Firebase anonymous auth failed:",e)});const i=new URLSearchParams(window.location.search).get("roomId");if(!i)return console.error("❌ roomId missing");console.log(`🚀 Joining calls/${i}`);const p=r.ref(`calls/${i}`),a=r.ref(`calls/${i}/users`),o=r.ref(`calls/${i}/signals`),s=a.push({joined:Date.now()}),l=s.key;console.log(`👤 User ${l} joined`),s.onDisconnect().remove(),p.onDisconnect().remove();const k=document.getElementById("localVideo"),O=document.getElementById("remoteVideo"),g=document.getElementById("btnToggleMic"),y=document.getElementById("btnToggleCam");let n=null;try{n=yield navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),n.getTracks().forEach(e=>e.enabled=!1),k.srcObject=n,g.disabled=!1,y.disabled=!1}catch(e){console.warn("🎥 getUserMedia failed – receive-only mode")}const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});n?n.getTracks().forEach(e=>t.addTrack(e,n)):(t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"}));const w=new MediaStream;O.srcObject=w,t.ontrack=e=>w.addTrack(e.track),t.onicecandidate=e=>{e.candidate&&o.push({type:"candidate",from:l,payload:e.candidate.toJSON()})};const x=yield new Promise(e=>{a.once("value",c=>{const d=Object.keys(c.val()||{});d.sort(),e(d[0]===l)})});let v=!1;if(o.on("child_added",e=>h(null,null,function*(){const c=e.val();if(c.from!==l)try{switch(c.type){case"offer":if(v||t.currentRemoteDescription)return;v=!0,yield t.setRemoteDescription(c.payload);const d=yield t.createAnswer();yield t.setLocalDescription(d),o.push({type:"answer",from:l,payload:d}),console.log("📨 Answer sent");break;case"answer":t.currentRemoteDescription||(yield t.setRemoteDescription(c.payload));break;case"candidate":yield t.addIceCandidate(new RTCIceCandidate(c.payload));break}}catch(d){console.warn("⚠️ Signal handling error:",d)}})),x){const e=yield t.createOffer();yield t.setLocalDescription(e),o.push({type:"offer",from:l,payload:e}),console.log("📨 Offer sent (I’m offerer)")}else console.log("🕗 Waiting for offer… (I’m answerer)");t.oniceconnectionstatechange=()=>{t.iceConnectionState==="connected"&&o.remove().catch(()=>{})},n&&(g.onclick=()=>{const e=n.getAudioTracks()[0];e.enabled=!e.enabled,g.textContent=e.enabled?"🎤 Mic":"🔇 Mic"},y.onclick=()=>{const e=n.getVideoTracks()[0];e.enabled=!e.enabled,y.textContent=e.enabled?"📹 Cam":"🚫 Cam",k.style.opacity=e.enabled?"1":"0.3"}),window.addEventListener("beforeunload",()=>{t.close(),n&&n.getTracks().forEach(e=>e.stop())})}))})();
