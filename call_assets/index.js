var D=Object.defineProperty;var I=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var L=(l,i,n)=>i in l?D(l,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[i]=n,S=(l,i)=>{for(var n in i||(i={}))A.call(i,n)&&L(l,n,i[n]);if(I)for(var n of I(i))R.call(i,n)&&L(l,n,i[n]);return l};var k=(l,i,n)=>new Promise((v,b)=>{var u=r=>{try{t(n.next(r))}catch(p){b(p)}},o=r=>{try{t(n.throw(r))}catch(p){b(p)}},t=r=>r.done?v(r.value):Promise.resolve(r.value).then(u,o);t((n=n.apply(l,i)).next())});(function(){"use strict";var l=document.createElement("style");l.textContent=`body{margin-top:4.6vh;font-family:system-ui,sans-serif;background:#111;color:#fff;display:flex;flex-direction:column;align-items:center;gap:6vh}.videos{display:flex;flex-direction:row;justify-content:center;gap:2vw;width:93vw;height:73vh}video{background:#000;width:50%;height:100%;max-width:480px;aspect-ratio:16/9;object-fit:cover;border:2px solid #444;border-radius:15px}.controls{display:flex;gap:8px}.controls button{background:#222;color:#ddd;transition:background .3s;padding:8px 12px;border-radius:8px;border:none;font-size:14px;cursor:pointer}.controls button:disabled{opacity:.5;cursor:not-allowed}.controls button:hover:not(:disabled){background:#333}.spinner{display:inline-block;animation:spin 1.2s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
/*$vite$:1*/`,document.head.appendChild(l),window.addEventListener("message",u=>{var f;if(((f=u.data)==null?void 0:f.type)!=="restoreCamMic")return;const{camOn:o,micOn:t}=u.data;if(!window.localStream){window.__pendingCamMicState={camOn:o,micOn:t};return}const r=window.localStream.getVideoTracks()[0],p=window.localStream.getAudioTracks()[0];typeof o=="boolean"&&r&&(r.enabled=o,document.getElementById("btnToggleCam").innerHTML=o?"ðŸ“¹ Cam":"ðŸš« Cam",document.getElementById("localVideo").style.opacity=o?"1":"0.3"),typeof t=="boolean"&&p&&(p.enabled=t,document.getElementById("btnToggleMic").innerHTML=t?"ðŸŽ¤ Mic":"ðŸš« Mic")});const i={apiKey:"AIzaSyDhppVbz4-sx1oYls62iXOPOR8Yrq-N9Qk",authDomain:"binger-video-call.firebaseapp.com",databaseURL:"https://binger-video-call-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"binger-video-call",storageBucket:"binger-video-call.firebasestorage.app",messagingSenderId:"1025922887951",appId:"1:1025922887951:web:70f733811d4ed19a8d8e7a"};firebase.initializeApp(i,"caller"),firebase.database.INTERNAL.forceWebSockets();const n=firebase.app("caller").database();function v(){return k(this,null,function*(){return new Promise(u=>{const o=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["stun:hk-turn1.xirsys.com"]},{username:"X4wXbtbVmlOqNhOpTzEyIXrHCWjAeNepUjkzMoLOnDQyPPDnZeO3HCSKDDTIW6oEAAAAAGh_w2hob2FuZ3R1Mw==",credential:"35e524c2-671d-11f0-a840-0242ac120004",urls:["turn:hk-turn1.xirsys.com:80?transport=udp","turn:hk-turn1.xirsys.com:3478?transport=udp","turn:hk-turn1.xirsys.com:80?transport=tcp","turn:hk-turn1.xirsys.com:3478?transport=tcp","turns:hk-turn1.xirsys.com:443?transport=tcp","turns:hk-turn1.xirsys.com:5349?transport=tcp"]}]});let t=!1;o.onicecandidate=r=>{if(!r.candidate){o.close(),u(!t);return}(r.candidate.candidate.includes("srflx")||r.candidate.candidate.includes("relay"))&&(t=!0)},o.createDataChannel("probe"),o.createOffer().then(r=>o.setLocalDescription(r)).catch(()=>u(!0))})})}function b(u){const o=document.getElementById("remoteVideo"),t=o.getBoundingClientRect();Object.assign(u.style,{position:"fixed",top:`${t.top}px`,left:`${t.left}px`,width:`${t.width}px`,height:`${t.height}px`,zIndex:"9999",background:"rgba(0, 0, 0, 0.7)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",pointerEvents:"none",borderRadius:window.getComputedStyle(o).borderRadius})}document.addEventListener("DOMContentLoaded",()=>k(null,null,function*(){yield firebase.app("caller").auth().signInAnonymously().catch(e=>{console.error("Firebase anonymous auth failed:",e)});const t=new URLSearchParams(window.location.search).get("roomId");if(!t)return console.error("âŒ roomId missing");console.log(`ðŸš€ Joining calls/${t}`),(yield v())&&window.parent!==window&&window.parent.postMessage({type:"network-warning"},"*");const p=n.ref(`calls/${t}`),f=n.ref(`calls/${t}/users`),g=n.ref(`calls/${t}/signals`),x=f.push({joined:Date.now()}),y=x.key;console.log(`ðŸ‘¤ User ${y} joined`),x.onDisconnect().remove(),p.onDisconnect().remove();const O=document.getElementById("localVideo"),C=document.getElementById("remoteVideo"),h=document.getElementById("btnToggleMic"),w=document.getElementById("btnToggleCam");let s=null;try{s=yield navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),window.localStream=s,window.__pendingCamMicState&&(window.postMessage(S({type:"restoreCamMic"},window.__pendingCamMicState),"*"),delete window.__pendingCamMicState),s.getTracks().forEach(e=>e.enabled=!1),O.srcObject=s,h.disabled=!1,w.disabled=!1,h.innerHTML="ðŸš« Mic",w.innerHTML="ðŸš« Cam"}catch(e){console.warn("ðŸŽ¥ getUserMedia failed â€“ receive-only mode")}const a=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["stun:hk-turn1.xirsys.com"]},{username:"X4wXbtbVmlOqNhOpTzEyIXrHCWjAeNepUjkzMoLOnDQyPPDnZeO3HCSKDDTIW6oEAAAAAGh_w2hob2FuZ3R1Mw==",credential:"35e524c2-671d-11f0-a840-0242ac120004",urls:["turn:hk-turn1.xirsys.com:80?transport=udp","turn:hk-turn1.xirsys.com:3478?transport=udp","turn:hk-turn1.xirsys.com:80?transport=tcp","turn:hk-turn1.xirsys.com:3478?transport=tcp","turns:hk-turn1.xirsys.com:443?transport=tcp","turns:hk-turn1.xirsys.com:5349?transport=tcp"]}]});s?s.getTracks().forEach(e=>a.addTrack(e,s)):(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}));const M=new MediaStream;C.srcObject=M,a.ontrack=e=>M.addTrack(e.track);const m=document.createElement("div");m.id="remoteLoading",m.innerHTML=`
    <div style="text-align: center;">
      <div class="spinner" style="
        border: 4px solid #fff;
        border-top: 4px solid transparent;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        margin: 0 auto 12px;
      "></div>
      <div>Waiting for video...</div>
    </div>
  `,b(m),document.body.appendChild(m),C.onplaying=()=>{m.remove()},window.addEventListener("resize",()=>{document.body.contains(m)&&b(m)}),a.onicecandidate=e=>{e.candidate&&g.push({type:"candidate",from:y,payload:e.candidate.toJSON()})};const E=yield new Promise(e=>{f.once("value",c=>{const d=Object.keys(c.val()||{});d.sort(),e(d[0]===y)})});let T=!1;if(g.on("child_added",e=>k(null,null,function*(){const c=e.val();if(c.from!==y)try{switch(c.type){case"offer":if(T||a.currentRemoteDescription)return;T=!0,yield a.setRemoteDescription(c.payload);const d=yield a.createAnswer();yield a.setLocalDescription(d),g.push({type:"answer",from:y,payload:d}),console.log("ðŸ“¨ Answer sent");break;case"answer":a.currentRemoteDescription||(yield a.setRemoteDescription(c.payload));break;case"candidate":yield a.addIceCandidate(new RTCIceCandidate(c.payload));break}}catch(d){console.warn("âš ï¸ Signal handling error:",d)}})),E){const e=yield a.createOffer();yield a.setLocalDescription(e),g.push({type:"offer",from:y,payload:e}),console.log("ðŸ“¨ Offer sent (Iâ€™m offerer)")}else console.log("ðŸ•— Waiting for offerâ€¦ (Iâ€™m answerer)");a.oniceconnectionstatechange=()=>{a.iceConnectionState==="connected"&&g.remove().catch(()=>{})},s&&(h.onclick=()=>{var c,d;const e=s.getAudioTracks()[0];e.enabled=!e.enabled,h.innerHTML=e.enabled?"ðŸŽ¤ Mic":"ðŸš« Mic",window.parent.postMessage({type:"updateCamMic",camOn:(d=(c=s.getVideoTracks()[0])==null?void 0:c.enabled)!=null?d:!1,micOn:e.enabled},"*")},w.onclick=()=>{var c,d;const e=s.getVideoTracks()[0];e.enabled=!e.enabled,w.innerHTML=e.enabled?"ðŸ“¹ Cam":"ðŸš« Cam",O.style.opacity=e.enabled?"1":"0.3",window.parent.postMessage({type:"updateCamMic",camOn:e.enabled,micOn:(d=(c=s.getAudioTracks()[0])==null?void 0:c.enabled)!=null?d:!1},"*")}),window.addEventListener("beforeunload",()=>{a.close(),s&&s.getTracks().forEach(e=>e.stop())})}))})();
