var h=(m,y,s)=>new Promise((w,l)=>{var c=n=>{try{r(s.next(n))}catch(i){l(i)}},o=n=>{try{r(s.throw(n))}catch(i){l(i)}},r=n=>n.done?w(n.value):Promise.resolve(n.value).then(c,o);r((s=s.apply(m,y)).next())});(function(){"use strict";var m=document.createElement("style");m.textContent=`body{margin-top:4.6vh;font-family:system-ui,sans-serif;background:#111;color:#fff;display:flex;flex-direction:column;align-items:center;gap:6vh}.videos{display:flex;flex-direction:row;justify-content:center;gap:2vw;width:93vw;height:73vh}video{background:#000;width:50%;height:100%;max-width:480px;aspect-ratio:16/9;object-fit:cover;border:2px solid #444;border-radius:15px}.controls{display:flex;gap:8px}.controls button{background:#222;color:#ddd;transition:background .3s;padding:8px 12px;border-radius:8px;border:none;font-size:14px;cursor:pointer}.controls button:disabled{opacity:.5;cursor:not-allowed}.controls button:hover:not(:disabled){background:#333}
/*$vite$:1*/`,document.head.appendChild(m);const y={apiKey:"AIzaSyDhppVbz4-sx1oYls62iXOPOR8Yrq-N9Qk",authDomain:"binger-video-call.firebaseapp.com",databaseURL:"https://binger-video-call-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"binger-video-call",storageBucket:"binger-video-call.firebasestorage.app",messagingSenderId:"1025922887951",appId:"1:1025922887951:web:70f733811d4ed19a8d8e7a"};firebase.initializeApp(y,"caller"),firebase.database.INTERNAL.forceWebSockets();const s=firebase.app("caller").database();function w(){return h(this,null,function*(){return new Promise(l=>{const c=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});let o=!1;c.onicecandidate=r=>{if(!r.candidate){c.close(),l(!o);return}r.candidate.candidate.includes("srflx")&&(o=!0)},c.createDataChannel("probe"),c.createOffer().then(r=>c.setLocalDescription(r)).catch(()=>l(!0))})})}document.addEventListener("DOMContentLoaded",()=>h(null,null,function*(){yield firebase.app("caller").auth().signInAnonymously().catch(e=>{console.error("Firebase anonymous auth failed:",e)});const o=new URLSearchParams(window.location.search).get("roomId");if(!o)return console.error("âŒ roomId missing");console.log(`ðŸš€ Joining calls/${o}`);const r=localStorage.getItem(`binger_cam_${o}`),n=localStorage.getItem(`binger_mic_${o}`),i=r!=="1",k=n!=="1";(yield w())&&window.parent!==window&&window.parent.postMessage({type:"network-warning"},"*");const S=s.ref(`calls/${o}`),O=s.ref(`calls/${o}/users`),u=s.ref(`calls/${o}/signals`),C=O.push({joined:Date.now()}),p=C.key;console.log(`ðŸ‘¤ User ${p} joined`),C.onDisconnect().remove(),S.onDisconnect().remove();const v=document.getElementById("localVideo"),L=document.getElementById("remoteVideo"),g=document.getElementById("btnToggleMic"),b=document.getElementById("btnToggleCam");let a=null;try{a=yield navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),a.getVideoTracks().forEach(e=>e.enabled=i),a.getAudioTracks().forEach(e=>e.enabled=k),v.srcObject=a,g.disabled=!1,b.disabled=!1,g.textContent=k?"ðŸŽ¤ Mic":"ðŸš« Mic",b.textContent=i?"ðŸ“¹ Cam":"ðŸš« Cam",v.style.opacity=i?"1":"0.3"}catch(e){console.warn("ðŸŽ¥ getUserMedia failed â€“ receive-only mode")}const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});a?a.getTracks().forEach(e=>t.addTrack(e,a)):(t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"}));const I=new MediaStream;L.srcObject=I,t.ontrack=e=>I.addTrack(e.track),t.onicecandidate=e=>{e.candidate&&u.push({type:"candidate",from:p,payload:e.candidate.toJSON()})};const R=yield new Promise(e=>{O.once("value",d=>{const f=Object.keys(d.val()||{});f.sort(),e(f[0]===p)})});let x=!1;if(u.on("child_added",e=>h(null,null,function*(){const d=e.val();if(d.from!==p)try{switch(d.type){case"offer":if(x||t.currentRemoteDescription)return;x=!0,yield t.setRemoteDescription(d.payload);const f=yield t.createAnswer();yield t.setLocalDescription(f),u.push({type:"answer",from:p,payload:f}),console.log("ðŸ“¨ Answer sent");break;case"answer":t.currentRemoteDescription||(yield t.setRemoteDescription(d.payload));break;case"candidate":yield t.addIceCandidate(new RTCIceCandidate(d.payload));break}}catch(f){console.warn("âš ï¸ Signal handling error:",f)}})),R){const e=yield t.createOffer();yield t.setLocalDescription(e),u.push({type:"offer",from:p,payload:e}),console.log("ðŸ“¨ Offer sent (Iâ€™m offerer)")}else console.log("ðŸ•— Waiting for offerâ€¦ (Iâ€™m answerer)");t.oniceconnectionstatechange=()=>{t.iceConnectionState==="connected"&&u.remove().catch(()=>{})},a&&(g.onclick=()=>{const e=a.getAudioTracks()[0];e.enabled=!e.enabled,localStorage.setItem(`binger_mic_${o}`,e.enabled?"1":"0"),g.textContent=e.enabled?"ðŸŽ¤ Mic":"ðŸš« Mic"},b.onclick=()=>{const e=a.getVideoTracks()[0];e.enabled=!e.enabled,localStorage.setItem(`binger_cam_${o}`,e.enabled?"1":"0"),b.textContent=e.enabled?"ðŸ“¹ Cam":"ðŸš« Cam",v.style.opacity=e.enabled?"1":"0.3"}),window.addEventListener("beforeunload",()=>{t.close(),a&&a.getTracks().forEach(e=>e.stop())})}))})();
