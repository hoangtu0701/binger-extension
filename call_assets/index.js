var L=Object.defineProperty;var M=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var T=(f,r,t)=>r in f?L(f,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[r]=t,x=(f,r)=>{for(var t in r||(r={}))E.call(r,t)&&T(f,t,r[t]);if(M)for(var t of M(r))R.call(r,t)&&T(f,t,r[t]);return f};var w=(f,r,t)=>new Promise((b,m)=>{var i=a=>{try{s(t.next(a))}catch(p){m(p)}},o=a=>{try{s(t.throw(a))}catch(p){m(p)}},s=a=>a.done?b(a.value):Promise.resolve(a.value).then(i,o);s((t=t.apply(f,r)).next())});(function(){"use strict";var f=document.createElement("style");f.textContent=`body{margin-top:4.6vh;font-family:system-ui,sans-serif;background:#111;color:#fff;display:flex;flex-direction:column;align-items:center;gap:6vh}.videos{display:flex;flex-direction:row;justify-content:center;gap:2vw;width:93vw;height:73vh}video{background:#000;width:50%;height:100%;max-width:480px;aspect-ratio:16/9;object-fit:cover;border:2px solid #444;border-radius:15px}.controls{display:flex;gap:8px}.controls button{background:#222;color:#ddd;transition:background .3s;padding:8px 12px;border-radius:8px;border:none;font-size:14px;cursor:pointer}.controls button:disabled{opacity:.5;cursor:not-allowed}.controls button:hover:not(:disabled){background:#333}
/*$vite$:1*/`,document.head.appendChild(f),window.addEventListener("message",m=>{var p;if(((p=m.data)==null?void 0:p.type)!=="restoreCamMic")return;const{camOn:i,micOn:o}=m.data;if(!window.localStream){window.__pendingCamMicState={camOn:i,micOn:o};return}const s=window.localStream.getVideoTracks()[0],a=window.localStream.getAudioTracks()[0];typeof i=="boolean"&&s&&(s.enabled=i,document.getElementById("btnToggleCam").textContent=i?"ðŸ“¹ Cam":"ðŸš« Cam",document.getElementById("localVideo").style.opacity=i?"1":"0.3"),typeof o=="boolean"&&a&&(a.enabled=o,document.getElementById("btnToggleMic").textContent=o?"ðŸŽ¤ Mic":"ðŸš« Mic")});const r={apiKey:"AIzaSyDhppVbz4-sx1oYls62iXOPOR8Yrq-N9Qk",authDomain:"binger-video-call.firebaseapp.com",databaseURL:"https://binger-video-call-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"binger-video-call",storageBucket:"binger-video-call.firebasestorage.app",messagingSenderId:"1025922887951",appId:"1:1025922887951:web:70f733811d4ed19a8d8e7a"};firebase.initializeApp(r,"caller"),firebase.database.INTERNAL.forceWebSockets();const t=firebase.app("caller").database();function b(){return w(this,null,function*(){return new Promise(m=>{const i=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});let o=!1;i.onicecandidate=s=>{if(!s.candidate){i.close(),m(!o);return}s.candidate.candidate.includes("srflx")&&(o=!0)},i.createDataChannel("probe"),i.createOffer().then(s=>i.setLocalDescription(s)).catch(()=>m(!0))})})}document.addEventListener("DOMContentLoaded",()=>w(null,null,function*(){yield firebase.app("caller").auth().signInAnonymously().catch(e=>{console.error("Firebase anonymous auth failed:",e)});const o=new URLSearchParams(window.location.search).get("roomId");if(!o)return console.error("âŒ roomId missing");console.log(`ðŸš€ Joining calls/${o}`),(yield b())&&window.parent!==window&&window.parent.postMessage({type:"network-warning"},"*");const a=t.ref(`calls/${o}`),p=t.ref(`calls/${o}/users`),u=t.ref(`calls/${o}/signals`),k=p.push({joined:Date.now()}),g=k.key;console.log(`ðŸ‘¤ User ${g} joined`),k.onDisconnect().remove(),a.onDisconnect().remove();const v=document.getElementById("localVideo"),I=document.getElementById("remoteVideo"),y=document.getElementById("btnToggleMic"),h=document.getElementById("btnToggleCam");let c=null;try{c=yield navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),window.localStream=c,window.__pendingCamMicState&&(window.postMessage(x({type:"restoreCamMic"},window.__pendingCamMicState),"*"),delete window.__pendingCamMicState),c.getTracks().forEach(e=>e.enabled=!1),v.srcObject=c,y.disabled=!1,h.disabled=!1}catch(e){console.warn("ðŸŽ¥ getUserMedia failed â€“ receive-only mode")}const n=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});c?c.getTracks().forEach(e=>n.addTrack(e,c)):(n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"}));const C=new MediaStream;I.srcObject=C,n.ontrack=e=>C.addTrack(e.track),n.onicecandidate=e=>{e.candidate&&u.push({type:"candidate",from:g,payload:e.candidate.toJSON()})};const S=yield new Promise(e=>{p.once("value",d=>{const l=Object.keys(d.val()||{});l.sort(),e(l[0]===g)})});let O=!1;if(u.on("child_added",e=>w(null,null,function*(){const d=e.val();if(d.from!==g)try{switch(d.type){case"offer":if(O||n.currentRemoteDescription)return;O=!0,yield n.setRemoteDescription(d.payload);const l=yield n.createAnswer();yield n.setLocalDescription(l),u.push({type:"answer",from:g,payload:l}),console.log("ðŸ“¨ Answer sent");break;case"answer":n.currentRemoteDescription||(yield n.setRemoteDescription(d.payload));break;case"candidate":yield n.addIceCandidate(new RTCIceCandidate(d.payload));break}}catch(l){console.warn("âš ï¸ Signal handling error:",l)}})),S){const e=yield n.createOffer();yield n.setLocalDescription(e),u.push({type:"offer",from:g,payload:e}),console.log("ðŸ“¨ Offer sent (Iâ€™m offerer)")}else console.log("ðŸ•— Waiting for offerâ€¦ (Iâ€™m answerer)");n.oniceconnectionstatechange=()=>{n.iceConnectionState==="connected"&&u.remove().catch(()=>{})},c&&(y.onclick=()=>{var d,l;const e=c.getAudioTracks()[0];e.enabled=!e.enabled,y.textContent=e.enabled?"ðŸŽ¤ Mic":"ðŸš« Mic",window.parent.postMessage({type:"updateCamMic",camOn:(l=(d=c.getVideoTracks()[0])==null?void 0:d.enabled)!=null?l:!1,micOn:e.enabled},"*")},h.onclick=()=>{var d,l;const e=c.getVideoTracks()[0];e.enabled=!e.enabled,h.textContent=e.enabled?"ðŸ“¹ Cam":"ðŸš« Cam",v.style.opacity=e.enabled?"1":"0.3",window.parent.postMessage({type:"updateCamMic",camOn:e.enabled,micOn:(l=(d=c.getAudioTracks()[0])==null?void 0:d.enabled)!=null?l:!1},"*")}),window.addEventListener("beforeunload",()=>{n.close(),c&&c.getTracks().forEach(e=>e.stop())})}))})();
