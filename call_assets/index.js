var A=Object.defineProperty;var I=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var S=(l,a,n)=>a in l?A(l,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[a]=n,E=(l,a)=>{for(var n in a||(a={}))R.call(a,n)&&S(l,n,a[n]);if(I)for(var n of I(a))P.call(a,n)&&S(l,n,a[n]);return l};var k=(l,a,n)=>new Promise((v,g)=>{var u=r=>{try{t(n.next(r))}catch(p){g(p)}},o=r=>{try{t(n.throw(r))}catch(p){g(p)}},t=r=>r.done?v(r.value):Promise.resolve(r.value).then(u,o);t((n=n.apply(l,a)).next())});(function(){"use strict";var l=document.createElement("style");l.textContent=`body{margin-top:4.6vh;font-family:system-ui,sans-serif;background:#111;color:#fff;display:flex;flex-direction:column;align-items:center;gap:6vh}.videos{display:flex;flex-direction:row;justify-content:center;gap:2vw;width:93vw;height:73vh}video{background:#000;width:50%;height:100%;max-width:480px;aspect-ratio:16/9;object-fit:cover;border:2px solid #444;border-radius:15px}.controls{display:flex;gap:8px}.controls button{background:#222;color:#ddd;transition:background .3s;padding:8px 12px;border-radius:8px;border:none;font-size:14px;cursor:pointer}.controls button:disabled{opacity:.5;cursor:not-allowed}.controls button:hover:not(:disabled){background:#333}.spinner{display:inline-block;animation:spin 1.2s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
/*$vite$:1*/`,document.head.appendChild(l),window.addEventListener("message",u=>{var m;if(((m=u.data)==null?void 0:m.type)!=="restoreCamMic")return;const{camOn:o,micOn:t}=u.data;if(!window.localStream){window.__pendingCamMicState={camOn:o,micOn:t};return}const r=window.localStream.getVideoTracks()[0],p=window.localStream.getAudioTracks()[0];typeof o=="boolean"&&r&&(r.enabled=o,document.getElementById("btnToggleCam").innerHTML=o?"üìπ Cam":"üö´ Cam",document.getElementById("localVideo").style.opacity=o?"1":"0.3"),typeof t=="boolean"&&p&&(p.enabled=t,document.getElementById("btnToggleMic").innerHTML=t?"üé§ Mic":"üö´ Mic")});const a={apiKey:"AIzaSyDhppVbz4-sx1oYls62iXOPOR8Yrq-N9Qk",authDomain:"binger-video-call.firebaseapp.com",databaseURL:"https://binger-video-call-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"binger-video-call",storageBucket:"binger-video-call.firebasestorage.app",messagingSenderId:"1025922887951",appId:"1:1025922887951:web:70f733811d4ed19a8d8e7a"};firebase.initializeApp(a,"caller"),firebase.database.INTERNAL.forceWebSockets();const n=firebase.app("caller").database();function v(){return k(this,null,function*(){return new Promise(u=>{const o=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["stun:hk-turn1.xirsys.com"]},{username:"X4wXbtbVmlOqNhOpTzEyIXrHCWjAeNepUjkzMoLOnDQyPPDnZeO3HCSKDDTIW6oEAAAAAGh_w2hob2FuZ3R1Mw==",credential:"35e524c2-671d-11f0-a840-0242ac120004",urls:["turn:hk-turn1.xirsys.com:80?transport=udp","turn:hk-turn1.xirsys.com:3478?transport=udp","turn:hk-turn1.xirsys.com:80?transport=tcp","turn:hk-turn1.xirsys.com:3478?transport=tcp","turns:hk-turn1.xirsys.com:443?transport=tcp","turns:hk-turn1.xirsys.com:5349?transport=tcp"]}]});let t=!1;o.onicecandidate=r=>{if(!r.candidate){o.close(),u(!t);return}(r.candidate.candidate.includes("srflx")||r.candidate.candidate.includes("relay"))&&(t=!0)},o.createDataChannel("probe"),o.createOffer().then(r=>o.setLocalDescription(r)).catch(()=>u(!0))})})}function g(u){const o=document.getElementById("remoteVideo"),t=o.getBoundingClientRect();Object.assign(u.style,{position:"fixed",top:`${t.top}px`,left:`${t.left}px`,width:`${t.width}px`,height:`${t.height}px`,zIndex:"9999",background:"rgba(0, 0, 0, 0.7)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",pointerEvents:"none",borderRadius:window.getComputedStyle(o).borderRadius})}document.addEventListener("DOMContentLoaded",()=>k(null,null,function*(){yield firebase.app("caller").auth().signInAnonymously().catch(e=>{console.error("Firebase anonymous auth failed:",e)});const t=new URLSearchParams(window.location.search).get("roomId");if(!t)return console.error("‚ùå roomId missing");console.log(`üöÄ Joining calls/${t}`),(yield v())&&window.parent!==window&&window.parent.postMessage({type:"network-warning"},"*");const p=n.ref(`calls/${t}`),m=n.ref(`calls/${t}/users`),y=n.ref(`calls/${t}/signals`),O=m.push({joined:Date.now()}),w=O.key;console.log(`üë§ User ${w} joined`),O.onDisconnect().remove(),p.onDisconnect().remove();const C=document.getElementById("localVideo"),M=document.getElementById("remoteVideo"),b=document.getElementById("btnToggleMic"),h=document.getElementById("btnToggleCam");let s=null;try{s=yield navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),window.localStream=s,window.__pendingCamMicState&&(window.postMessage(E({type:"restoreCamMic"},window.__pendingCamMicState),"*"),delete window.__pendingCamMicState),s.getTracks().forEach(e=>e.enabled=!1),C.srcObject=s,b.disabled=!1,h.disabled=!1,b.innerHTML="üö´ Mic",h.innerHTML="üö´ Cam"}catch(e){console.warn("üé• getUserMedia failed ‚Äì receive-only mode")}const i=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["stun:hk-turn1.xirsys.com"]},{username:"X4wXbtbVmlOqNhOpTzEyIXrHCWjAeNepUjkzMoLOnDQyPPDnZeO3HCSKDDTIW6oEAAAAAGh_w2hob2FuZ3R1Mw==",credential:"35e524c2-671d-11f0-a840-0242ac120004",urls:["turn:hk-turn1.xirsys.com:80?transport=udp","turn:hk-turn1.xirsys.com:3478?transport=udp","turn:hk-turn1.xirsys.com:80?transport=tcp","turn:hk-turn1.xirsys.com:3478?transport=tcp","turns:hk-turn1.xirsys.com:443?transport=tcp","turns:hk-turn1.xirsys.com:5349?transport=tcp"]}]});s?s.getTracks().forEach(e=>i.addTrack(e,s)):(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}));const T=new MediaStream;M.srcObject=T,i.ontrack=e=>T.addTrack(e.track);const f=document.createElement("div");f.id="remoteLoading",f.innerHTML="<div>Calling...</div>",g(f),document.body.appendChild(f);function x(){document.body.contains(f)&&g(f)}window.addEventListener("resize",x),M.onplaying=()=>{f.remove(),window.removeEventListener("resize",x)},i.onicecandidate=e=>{e.candidate&&y.push({type:"candidate",from:w,payload:e.candidate.toJSON()})};const D=yield new Promise(e=>{m.once("value",c=>{const d=Object.keys(c.val()||{});d.sort(),e(d[0]===w)})});let L=!1;if(y.on("child_added",e=>k(null,null,function*(){const c=e.val();if(c.from!==w)try{switch(c.type){case"offer":if(L||i.currentRemoteDescription)return;L=!0,yield i.setRemoteDescription(c.payload);const d=yield i.createAnswer();yield i.setLocalDescription(d),y.push({type:"answer",from:w,payload:d}),console.log("üì® Answer sent");break;case"answer":i.currentRemoteDescription||(yield i.setRemoteDescription(c.payload));break;case"candidate":yield i.addIceCandidate(new RTCIceCandidate(c.payload));break}}catch(d){console.warn("‚ö†Ô∏è Signal handling error:",d)}})),D){const e=yield i.createOffer();yield i.setLocalDescription(e),y.push({type:"offer",from:w,payload:e}),console.log("üì® Offer sent (I‚Äôm offerer)")}else console.log("üïó Waiting for offer‚Ä¶ (I‚Äôm answerer)");i.oniceconnectionstatechange=()=>{i.iceConnectionState==="connected"&&(y.remove().catch(()=>{}),f.innerHTML=`
        <div style="text-align: center;">
          <div class="spinner" style="
            border: 4px solid #fff;
            border-top: 4px solid transparent;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            margin: 0 auto 12px;
          "></div>
          <div>Waiting for video...</div>
        </div>
      `,g(f)),i.iceConnectionState==="failed"&&(f.innerHTML="<div>‚ùå Connection failed</div>",window.removeEventListener("resize",x))},s&&(b.onclick=()=>{var c,d;const e=s.getAudioTracks()[0];e.enabled=!e.enabled,b.innerHTML=e.enabled?"üé§ Mic":"üö´ Mic",window.parent.postMessage({type:"updateCamMic",camOn:(d=(c=s.getVideoTracks()[0])==null?void 0:c.enabled)!=null?d:!1,micOn:e.enabled},"*")},h.onclick=()=>{var c,d;const e=s.getVideoTracks()[0];e.enabled=!e.enabled,h.innerHTML=e.enabled?"üìπ Cam":"üö´ Cam",C.style.opacity=e.enabled?"1":"0.3",window.parent.postMessage({type:"updateCamMic",camOn:e.enabled,micOn:(d=(c=s.getAudioTracks()[0])==null?void 0:c.enabled)!=null?d:!1},"*")}),window.addEventListener("beforeunload",()=>{i.close(),s&&s.getTracks().forEach(e=>e.stop())})}))})();
