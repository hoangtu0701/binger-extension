var D=Object.defineProperty;var L=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var I=(u,a,n)=>a in u?D(u,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[a]=n,E=(u,a)=>{for(var n in a||(a={}))A.call(a,n)&&I(u,n,a[n]);if(L)for(var n of L(a))R.call(a,n)&&I(u,n,a[n]);return u};var h=(u,a,n)=>new Promise((k,g)=>{var p=o=>{try{t(n.next(o))}catch(c){g(c)}},r=o=>{try{t(n.throw(o))}catch(c){g(c)}},t=o=>o.done?k(o.value):Promise.resolve(o.value).then(p,r);t((n=n.apply(u,a)).next())});(function(){"use strict";var u=document.createElement("style");u.textContent=`body{margin-top:4.6vh;font-family:system-ui,sans-serif;background:#111;color:#fff;display:flex;flex-direction:column;align-items:center;gap:6vh}.videos{display:flex;flex-direction:row;justify-content:center;gap:2vw;width:93vw;height:73vh}video{background:#000;width:50%;height:100%;max-width:480px;aspect-ratio:16/9;object-fit:cover;border:2px solid #444;border-radius:15px}.controls{display:flex;gap:8px}.controls button{background:#222;color:#ddd;transition:background .3s;padding:8px 12px;border-radius:8px;border:none;font-size:14px;cursor:pointer}.controls button:disabled{opacity:.5;cursor:not-allowed}.controls button:hover:not(:disabled){background:#333}.spinner{display:inline-block;animation:spin 1.2s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
/*$vite$:1*/`,document.head.appendChild(u),window.addEventListener("message",p=>{var f;if(((f=p.data)==null?void 0:f.type)!=="restoreCamMic")return;const{camOn:r,micOn:t}=p.data;if(!window.localStream){window.__pendingCamMicState={camOn:r,micOn:t};return}const o=window.localStream.getVideoTracks()[0],c=window.localStream.getAudioTracks()[0];typeof r=="boolean"&&o&&(o.enabled=r,document.getElementById("btnToggleCam").innerHTML=r?"üìπ Cam":"üö´ Cam",document.getElementById("localVideo").style.opacity=r?"1":"0.3"),typeof t=="boolean"&&c&&(c.enabled=t,document.getElementById("btnToggleMic").innerHTML=t?"üé§ Mic":"üö´ Mic")});const a={apiKey:"AIzaSyDhppVbz4-sx1oYls62iXOPOR8Yrq-N9Qk",authDomain:"binger-video-call.firebaseapp.com",databaseURL:"https://binger-video-call-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"binger-video-call",storageBucket:"binger-video-call.firebasestorage.app",messagingSenderId:"1025922887951",appId:"1:1025922887951:web:70f733811d4ed19a8d8e7a"};firebase.initializeApp(a,"caller"),firebase.database.INTERNAL.forceWebSockets();const n=firebase.app("caller").database();function k(){return h(this,null,function*(){return new Promise(p=>{const r=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:["stun:hk-turn1.xirsys.com"]},{urls:"turn:relay1.expressturn.com:3480",username:"000000002068909891",credential:"aXZXgcUQf/fSE9PUID9byOo2BME="},{username:"X4wXbtbVmlOqNhOpTzEyIXrHCWjAeNepUjkzMoLOnDQyPPDnZeO3HCSKDDTIW6oEAAAAAGh_w2hob2FuZ3R1Mw==",credential:"35e524c2-671d-11f0-a840-0242ac120004",urls:["turn:hk-turn1.xirsys.com:80?transport=udp","turn:hk-turn1.xirsys.com:3478?transport=udp","turn:hk-turn1.xirsys.com:80?transport=tcp","turn:hk-turn1.xirsys.com:3478?transport=tcp","turns:hk-turn1.xirsys.com:443?transport=tcp","turns:hk-turn1.xirsys.com:5349?transport=tcp"]}]});let t=!1;r.onicecandidate=o=>{if(!o.candidate){r.close(),p(!t);return}(o.candidate.candidate.includes("srflx")||o.candidate.candidate.includes("relay"))&&(t=!0)},r.createDataChannel("probe"),r.createOffer().then(o=>r.setLocalDescription(o)).catch(()=>p(!0))})})}function g(p){const r=document.getElementById("remoteVideo"),t=r.getBoundingClientRect();Object.assign(p.style,{position:"fixed",top:`${t.top}px`,left:`${t.left}px`,width:`${t.width}px`,height:`${t.height}px`,zIndex:"9999",background:"rgba(0, 0, 0, 0.7)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",pointerEvents:"none",borderRadius:window.getComputedStyle(r).borderRadius})}document.addEventListener("DOMContentLoaded",()=>h(null,null,function*(){yield firebase.app("caller").auth().signInAnonymously().catch(e=>{console.error("Firebase anonymous auth failed:",e)});const t=new URLSearchParams(window.location.search).get("roomId");if(!t)return console.error("‚ùå roomId missing");console.log(`üöÄ Joining calls/${t}`);const o=n.ref(`calls/${t}`),c=n.ref(`calls/${t}/users`),f=n.ref(`calls/${t}/signals`),v=c.push({joined:Date.now()}),y=v.key;console.log(`üë§ User ${y} joined`),v.onDisconnect().remove(),o.onDisconnect().remove();const O=document.getElementById("localVideo"),C=document.getElementById("remoteVideo"),b=document.getElementById("btnToggleMic"),w=document.getElementById("btnToggleCam");let s=null;try{s=yield navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),window.localStream=s,window.__pendingCamMicState&&(window.postMessage(E({type:"restoreCamMic"},window.__pendingCamMicState),"*"),delete window.__pendingCamMicState),s.getTracks().forEach(e=>e.enabled=!1),O.srcObject=s,b.disabled=!1,w.disabled=!1,b.innerHTML="üö´ Mic",w.innerHTML="üö´ Cam"}catch(e){console.warn("üé• getUserMedia failed ‚Äì receive-only mode")}const i=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:["stun:hk-turn1.xirsys.com"]},{urls:"turn:relay1.expressturn.com:3480",username:"000000002068909891",credential:"aXZXgcUQf/fSE9PUID9byOo2BME="},{username:"X4wXbtbVmlOqNhOpTzEyIXrHCWjAeNepUjkzMoLOnDQyPPDnZeO3HCSKDDTIW6oEAAAAAGh_w2hob2FuZ3R1Mw==",credential:"35e524c2-671d-11f0-a840-0242ac120004",urls:["turn:hk-turn1.xirsys.com:80?transport=udp","turn:hk-turn1.xirsys.com:3478?transport=udp","turn:hk-turn1.xirsys.com:80?transport=tcp","turn:hk-turn1.xirsys.com:3478?transport=tcp","turns:hk-turn1.xirsys.com:443?transport=tcp","turns:hk-turn1.xirsys.com:5349?transport=tcp"]}]});s?s.getTracks().forEach(e=>i.addTrack(e,s)):(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}));const M=new MediaStream;C.srcObject=M,i.ontrack=e=>M.addTrack(e.track);const m=document.createElement("div");m.id="remoteLoading",m.innerHTML="<div>Calling...</div>",g(m),document.body.appendChild(m);function x(){document.body.contains(m)&&g(m)}window.addEventListener("resize",x),C.onplaying=()=>{m.remove(),window.removeEventListener("resize",x)},i.onicecandidate=e=>{e.candidate&&f.push({type:"candidate",from:y,payload:e.candidate.toJSON()})};const S=yield new Promise(e=>{c.once("value",d=>{const l=Object.keys(d.val()||{});l.sort(),e(l[0]===y)})});let T=!1;if(f.on("child_added",e=>h(null,null,function*(){const d=e.val();if(d.from!==y)try{switch(d.type){case"offer":if(T||i.currentRemoteDescription)return;T=!0,yield i.setRemoteDescription(d.payload);const l=yield i.createAnswer();yield i.setLocalDescription(l),f.push({type:"answer",from:y,payload:l}),console.log("üì® Answer sent");break;case"answer":i.currentRemoteDescription||(yield i.setRemoteDescription(d.payload));break;case"candidate":yield i.addIceCandidate(new RTCIceCandidate(d.payload));break}}catch(l){console.warn("‚ö†Ô∏è Signal handling error:",l)}})),S){const e=yield i.createOffer();yield i.setLocalDescription(e),f.push({type:"offer",from:y,payload:e}),console.log("üì® Offer sent (I‚Äôm offerer)")}else console.log("üïó Waiting for offer‚Ä¶ (I‚Äôm answerer)");i.oniceconnectionstatechange=()=>{i.iceConnectionState==="connected"&&(f.remove().catch(()=>{}),m.innerHTML=`
        <div style="text-align: center;">
          <div class="spinner" style="
            border: 4px solid #fff;
            border-top: 4px solid transparent;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            margin: 0 auto 12px;
          "></div>
          <div>Waiting for video...</div>
        </div>
      `,g(m)),i.iceConnectionState==="failed"&&(m.innerHTML="<div>‚ùå Connection failed</div>",window.removeEventListener("resize",x),k().then(e=>{e&&window.parent!==window&&window.parent.postMessage({type:"network-warning"},"*")}))},s&&(b.onclick=()=>{var d,l;const e=s.getAudioTracks()[0];e.enabled=!e.enabled,b.innerHTML=e.enabled?"üé§ Mic":"üö´ Mic",window.parent.postMessage({type:"updateCamMic",camOn:(l=(d=s.getVideoTracks()[0])==null?void 0:d.enabled)!=null?l:!1,micOn:e.enabled},"*")},w.onclick=()=>{var d,l;const e=s.getVideoTracks()[0];e.enabled=!e.enabled,w.innerHTML=e.enabled?"üìπ Cam":"üö´ Cam",O.style.opacity=e.enabled?"1":"0.3",window.parent.postMessage({type:"updateCamMic",camOn:e.enabled,micOn:(l=(d=s.getAudioTracks()[0])==null?void 0:d.enabled)!=null?l:!1},"*")}),window.addEventListener("beforeunload",()=>{i.close(),s&&s.getTracks().forEach(e=>e.stop())})}))})();
